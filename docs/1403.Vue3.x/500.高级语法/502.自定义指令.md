---
title: è‡ªå®šä¹‰æŒ‡ä»¤
date: 2022-03-24 22:19:20
permalink: /pages/aa7419/
categories:
  - x
  - é«˜çº§è¯­æ³•
tags:
  - 
---

# è‡ªå®šä¹‰æŒ‡ä»¤

## ä»‹ç»

åœ¨Vueçš„æ¨¡æ¿è¯­æ³•ä¸­æˆ‘ä»¬å­¦ä¹ è¿‡å„ç§å„æ ·çš„æŒ‡ä»¤ï¼šv-showã€v-forã€v-modelç­‰ç­‰ï¼Œé™¤äº†ä½¿ç”¨è¿™äº›æŒ‡ä»¤ä¹‹å¤–ï¼Œ**Vue ä¹Ÿå…è®¸æˆ‘ä»¬æ¥è‡ªå®šä¹‰è‡ªå·±çš„æŒ‡ä»¤ã€‚**

* æ³¨æ„:åœ¨Vueä¸­ï¼Œ**ä»£ç çš„å¤ç”¨å’ŒæŠ½è±¡**ä¸»è¦è¿˜æ˜¯é€šè¿‡**ç»„ä»¶**;
* é€šå¸¸åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä½ éœ€è¦**å¯¹DOMå…ƒç´ è¿›è¡Œåº•å±‚æ“ä½œ**ï¼Œè¿™ä¸ªæ—¶å€™å°±ä¼šç”¨åˆ°**è‡ªå®šä¹‰æŒ‡ä»¤**;

**è‡ªå®šä¹‰æŒ‡ä»¤åˆ†ä¸ºä¸¤ç§** :

* è‡ªå®šä¹‰å±€éƒ¨æŒ‡ä»¤ï¼šç»„ä»¶ä¸­é€šè¿‡ **directives** é€‰é¡¹ï¼Œåªèƒ½åœ¨å½“å‰ç»„ä»¶ä¸­ä½¿ç”¨; 
* è‡ªå®šä¹‰å…¨å±€æŒ‡ä»¤ï¼šappçš„ **directive** æ–¹æ³•ï¼Œå¯ä»¥åœ¨ä»»æ„ç»„ä»¶ä¸­è¢«ä½¿ç”¨;

**æ¯”å¦‚æˆ‘ä»¬æ¥åšä¸€ä¸ªéå¸¸ç®€å•çš„æ¡ˆä¾‹:å½“æŸä¸ªå…ƒç´ æŒ‚è½½å®Œæˆåå¯ä»¥è‡ªå®šè·å–ç„¦ç‚¹** 

* å®ç°æ–¹å¼ä¸€:å¦‚æœæˆ‘ä»¬ä½¿ç”¨é»˜è®¤çš„å®ç°æ–¹å¼;
* å®ç°æ–¹å¼äºŒ:è‡ªå®šä¹‰ä¸€ä¸ª v-focus çš„å±€éƒ¨æŒ‡ä»¤; 
* å®ç°æ–¹å¼ä¸‰:è‡ªå®šä¹‰ä¸€ä¸ª v-focus çš„å…¨å±€æŒ‡ä»¤;



## é»˜è®¤çš„å®ç°æ–¹å¼

```vue
<template>
  <div>
    <input type="text" ref="input">
  </div>
</template>

<script>
  import { ref, onMounted } from "vue";

  export default {
    setup() {
      const input = ref(null);

      onMounted(() => {
        input.value.focus();
      })

      return {
        input
      }
    }
  }
</script>
```



## å±€éƒ¨è‡ªå®šä¹‰æŒ‡ä»¤

* åœ¨**ç»„ä»¶ options é€‰é¡¹ä¸­**ä½¿ç”¨ **directives** å³å¯
* å®ƒæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œåœ¨å¯¹è±¡ä¸­ç¼–å†™æˆ‘ä»¬è‡ªå®šä¹‰æŒ‡ä»¤çš„åç§°ï¼ˆæ³¨æ„:è¿™é‡Œä¸éœ€è¦åŠ `v-`ï¼‰
* è‡ªå®šä¹‰æŒ‡ä»¤æœ‰ä¸€ä¸ª**ç”Ÿå‘½å‘¨æœŸ**ï¼Œæ˜¯åœ¨ç»„ä»¶æŒ‚è½½åè°ƒç”¨çš„ mountedï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å…¶ä¸­å®Œæˆæ“ä½œ

```vue
<template>
  <div>
    <input type="text" v-focus>
  </div>
</template>

<script>
  export default {
    // å±€éƒ¨æŒ‡ä»¤
    directives: {
      focus: {
        mounted(el, bindings, vnode, preVnode) {
          console.log("focus mounted");
          el.focus();
        }
      }
    }
  }
</script>
```





## å…¨å±€è‡ªå®šä¹‰æŒ‡ä»¤ ğŸ”¥

ä¸Šé¢çš„å±€éƒ¨è‡ªå®šä¹‰æŒ‡ä»¤ä¿®æ”¹ï¼š

main.js

```js
import { createApp } from 'vue'

const app = createApp(App)

app.directive("focus", {
  mounted(el, bindings, vnode, preVnode) {
    console.log("focus mounted");
    el.focus();
  }
})

app.mount('#app')
```

ç„¶åç›´æ¥ä½¿ç”¨å³å¯ï¼ï¼ï¼



## æŒ‡ä»¤çš„ç”Ÿå‘½å‘¨æœŸã€å‚æ•°ã€ä¿®é¥°ç¬¦ ğŸ”¥

**ä¸€ä¸ªæŒ‡ä»¤å®šä¹‰çš„å¯¹è±¡ï¼ŒVueæä¾›äº†å¦‚ä¸‹çš„å‡ ä¸ªé’©å­å‡½æ•°**ï¼š

* createdï¼šåœ¨ç»‘å®šå…ƒç´ çš„ attribute æˆ–äº‹ä»¶ç›‘å¬å™¨è¢«åº”ç”¨**ä¹‹å‰**è°ƒç”¨;
* beforeMountï¼šå½“**æŒ‡ä»¤ç¬¬ä¸€æ¬¡ç»‘å®š**åˆ°å…ƒç´ å¹¶ä¸”åœ¨**æŒ‚è½½çˆ¶ç»„ä»¶ä¹‹å‰**è°ƒç”¨; 
* **mounted**ï¼šåœ¨ç»‘å®šå…ƒç´ çš„çˆ¶ç»„ä»¶**è¢«æŒ‚è½½åè°ƒç”¨**; 
* beforeUpdateï¼šåœ¨æ›´æ–°åŒ…å«ç»„ä»¶çš„ VNode ä¹‹å‰è°ƒç”¨; 
* updatedï¼šåœ¨åŒ…å«ç»„ä»¶çš„ VNode **åŠå…¶å­ç»„ä»¶çš„ VNode** æ›´æ–°åè°ƒç”¨; 
* beforeUnmountï¼šåœ¨å¸è½½ç»‘å®šå…ƒç´ çš„çˆ¶ç»„ä»¶ä¹‹å‰è°ƒç”¨;
* unmountedï¼šå½“æŒ‡ä»¤ä¸å…ƒç´ è§£é™¤ç»‘å®šä¸”çˆ¶ç»„ä»¶å·²å¸è½½æ—¶ï¼Œåªè°ƒç”¨ä¸€æ¬¡;

åœ¨æˆ‘ä»¬çš„ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œæˆ‘ä»¬å¯ä»¥**é€šè¿‡ bindings è·å–åˆ°å¯¹åº”çš„å‚æ•°ï¼ˆvalueï¼‰å’Œä¿®é¥°ç¬¦å¯¹è±¡ï¼ˆmodifiersï¼‰**

```vue
<template>
  <div>
    <button v-if="counter < 2" v-why.aaaa.bbbb="'coderwhy'" @click="increment">å½“å‰è®¡æ•°: {{counter}}</button>
  </div>
</template>

<script>
  import { ref } from "vue";

  export default {
    // å±€éƒ¨æŒ‡ä»¤
    directives: {
      why: {
        // preVnode åœ¨ updated èŠ‚ç‚¹ä¼šæœ‰å€¼
        created(el, bindings, vnode, preVnode) {
          console.log("why created", el, bindings, vnode, preVnode);
          console.log(bindings.value);// å­—ç¬¦ä¸²
          console.log(bindings.modifiers);// æ˜¯ä¸ªå¯¹è±¡
        },
        beforeMount() {
          console.log("why beforeMount");
        },
        mounted() {
          console.log("why mounted");
        },
        beforeUpdate() {
          console.log("why beforeUpdate");
        },
        updated() {
          console.log("why updated");
        },
        beforeUnmount() {
          console.log("why beforeUnmount");
        },
        unmounted() {
          console.log("why unmounted");
        }
      }
    },
    setup() {
      const counter = ref(0);
      const increment = () => counter.value++;

      return {
        counter,
        increment
      }
    }
  }
</script>
```





## æ—¶é—´æˆ³æ ¼å¼åŒ–æŒ‡ä»¤ ğŸ”¥ğŸ”¥ğŸ”¥

å¼€å‘è¦æ±‚ï¼š

* åœ¨å¼€å‘ä¸­ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ä»æœåŠ¡å™¨è·å–åˆ°çš„éƒ½æ˜¯æ—¶é—´æˆ³;
* æˆ‘ä»¬éœ€è¦å°†æ—¶é—´æˆ³è½¬æ¢æˆå…·ä½“æ ¼å¼åŒ–çš„æ—¶é—´æ¥å±•ç¤º;
* åœ¨Vue2ä¸­æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿‡æ»¤å™¨æ¥å®Œæˆ;
* åœ¨Vue3ä¸­æˆ‘ä»¬å¯ä»¥é€šè¿‡ è®¡ç®—å±æ€§(computed) æˆ–è€… è‡ªå®šä¹‰ä¸€ä¸ªæ–¹æ³•(methods) æ¥å®Œæˆ; 
* å…¶å®æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ä¸€ä¸ªè‡ªå®šä¹‰çš„æŒ‡ä»¤æ¥å®Œæˆ;

å®ç°ä¸€ä¸ªå¯ä»¥è‡ªåŠ¨å¯¹**æ—¶é—´æ ¼å¼åŒ–çš„æŒ‡ä»¤v-format-time**

/src/directives/index.js

```js
import registerFormatTime from './format-time';

export default function registerDirectives(app) {
  registerFormatTime(app);
}
```

/src/directives/format-time.js

```js
import dayjs from 'dayjs'

export default function (app) {
  app.directive('format-time', {
    created(el, bindings) {
      bindings.formatString = 'YYYY-MM-DD HH:mm:ss'
      if (bindings.value) {
        bindings.formatString = bindings.value
      }
    },
    // éƒ½æ”¾å…¥ mounted ä¹Ÿä¸€æ ·ï¼
    mounted(el, bindings) {
      const textContent = el.textContent
      let timestamp = parseInt(textContent)
      if (textContent.length === 10) {
        timestamp = timestamp * 1000
      }
      el.textContent = dayjs(timestamp).format(bindings.formatString)
    },
  })
}
```

/src/main.js

```js
import registerDirectives from './directives'
registerDirectives(app)
```

